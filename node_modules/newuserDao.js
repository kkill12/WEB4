var Q = require('q');
var conn = require('db');
var content = require('content');

//公共值
var colname = null;
var tabledata = null;
var listdata = null;
var rowdata = null;
//构造函数
function userDao(){
	console.log('init ......');
	conn.connect();
}
module.exports= userDao;



//函数集合
userDao.prototype.fun = {
	init:function(tablename,req){
		console.log('getCol comming.........'+content._COLSQL);
		//注意函数的准确用法
		var defer = Q.defer();
		//取出本表所有存在的字段
		conn.query(content._COLSQL,tablename,function(err,data){
			if(err){
				defer.reject(err);
			}else{
				//数据库字符串转换成
				colname = content.tArr(data);
				//初始化表数据库列表
				tabledata = content.tCol(data);
				//将页面post中的数据初始化进入tabledata中
				for (var i=0;i<colname.length;i++){
					tabledata[colname[i]] = req.body[colname[i]];
				}
				console.log(tabledata);
				defer.resolve();
			}
		});
		return defer.promise;
	},
	insert:function(){
		console.log('inser comming ........');
		var defer = Q.defer();
		//回调函数+唤醒
		conn.query('INSERT INTO PMS_USERS SET  ?',tabledata,function(err,result){
			if(err){
				defer.reject(err);
			}else{

				defer.resolve(result);
			}
		});
		return defer.promise;
	},
	update:function(){
		console.log('update comming .......');
		var defer = Q.defer();
		conn.query('UPDATE PMS_USERS SET ? WHERE USERID="5"',tabledata,function(err,result){
			if(err){
				defer.reject(err);
			}else{
				defer.resolve(result);
			}
		});
		return defer.promise;
	},
	delete:function(){
		console.log('delete comming .......');
		var defer = Q.defer();
		par = {userid:'1',username:'kangyun'};
		conn.query('DELETE FROM PMS_USERS WHERE userid=? and username=?',['1','kangyun'],function(err,result){
			if(err){
				defer.reject(err);
			}else{
				defer.resolve(result);
			}			
		});
		return defer.promise;
	},
	find:function(){
		console.log('find comming .......');
		var defer = Q.defer();
		conn.query('SELECT * FROM PMS_USERS WHERE ',function(err,result){
		});
	},
	close:function(){
		console.log('database end()');
		conn.end();
	}
}


